#!/usr/bin/env bash
if [ ! -f .kattislanguage ]; then
    echo "Error: not a Kattis solution directory."
    exit 1
fi
language=$(cat .kattislanguage)
if [ ! -f ${KATTISROOT}/templates/${language}/run ]; then
    echo "Error: no run configuration found for ${language}."
    exit 1
fi
problem=$(cat ../.kattisproblem)
testdir=../tests
testcount=$(( $(ls -1 ${testdir} | wc -l) / 2 ))
echo "Checking ${problem}/${language} against ${testcount} test sample(s)..."
testlimit=$((testcount - 1))
allpassing="y"
for testnum in $(seq 0 ${testlimit}); do
    ${KATTISROOT}/templates/${language}/run ${problem} \
        < ${testdir}/${testnum}.tst \
        > check.out
    if diff check.out ${testdir}/${testnum}.out >/dev/null; then
      :
    else
        echo "Test ${testnum} failed."
        echo "--- Expected: ---"
        cat ${testdir}/${testnum}.out
        echo "---  Actual:  ---"
        cat check.out
        allpassing="n"
    fi
done
rm check.out
if [ $allpassing = "y" ]; then
    echo "All tests passing."
fi
